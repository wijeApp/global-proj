<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Country API Integration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Country API Integration Test</h1>
        <p>This page tests the country API integration for the employee forms.</p>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Add Employee Form Test</h3>
                <div class="mb-3">
                    <label class="form-label">Country</label>
                    <select class="form-select" id="addCountry">
                        <option value="">Loading countries...</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="testAddForm()">Test Add Form</button>
            </div>
            
            <div class="col-md-6">
                <h3>Edit Employee Form Test</h3>
                <div class="mb-3">
                    <label class="form-label">Country</label>
                    <select class="form-select" id="editCountry">
                        <option value="">Loading countries...</option>
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="testEditForm()">Test Edit Form</button>
            </div>
        </div>
        
        <div class="mt-4">
            <h3>API Response</h3>
            <pre id="apiResponse" class="bg-light p-3"></pre>
        </div>
        
        <div class="mt-4">
            <h3>Test Results</h3>
            <div id="testResults" class="alert alert-info">
                Tests will appear here...
            </div>
        </div>
    </div>

    <script>
        // Country API Service (same as in employee.html)
        class CountryAPI {
            constructor() {
                this.baseUrl = '/api/countries';
            }

            async getAllCountries() {
                try {
                    const response = await fetch(this.baseUrl);
                    if (response.status === 204) {
                        return [];
                    }
                    if (!response.ok) throw new Error('Failed to fetch countries');
                    return await response.json();
                } catch (error) {
                    console.error('Error fetching countries:', error);
                    return [];
                }
            }
        }

        const countryAPI = new CountryAPI();
        let countries = [];

        // Load countries on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCountries();
        });

        async function loadCountries() {
            try {
                countries = await countryAPI.getAllCountries();
                document.getElementById('apiResponse').textContent = JSON.stringify(countries, null, 2);
                populateCountryDropdowns();
                updateTestResults();
            } catch (error) {
                console.error('Error loading countries:', error);
                document.getElementById('testResults').innerHTML = 
                    '<div class="alert alert-danger">Error loading countries: ' + error.message + '</div>';
            }
        }

        function populateCountryDropdowns() {
            const addCountrySelect = document.getElementById('addCountry');
            const editCountrySelect = document.getElementById('editCountry');
            
            // Clear existing options
            addCountrySelect.innerHTML = '<option value="">Select Country</option>';
            editCountrySelect.innerHTML = '<option value="">Select Country</option>';
            
            // Add countries from API
            countries.forEach(country => {
                const addOption = document.createElement('option');
                addOption.value = country.countryName;
                addOption.textContent = country.countryName;
                addCountrySelect.appendChild(addOption);
                
                const editOption = document.createElement('option');
                editOption.value = country.countryName;
                editOption.textContent = country.countryName;
                editCountrySelect.appendChild(editOption);
            });
        }

        function updateTestResults() {
            const results = [];
            
            // Test 1: API Response
            if (countries.length > 0) {
                results.push('✅ API returned ' + countries.length + ' countries');
            } else {
                results.push('❌ API returned no countries');
            }
            
            // Test 2: Dropdown Population
            const addSelect = document.getElementById('addCountry');
            const editSelect = document.getElementById('editCountry');
            
            if (addSelect.options.length > 1) {
                results.push('✅ Add form dropdown populated with ' + (addSelect.options.length - 1) + ' countries');
            } else {
                results.push('❌ Add form dropdown not populated');
            }
            
            if (editSelect.options.length > 1) {
                results.push('✅ Edit form dropdown populated with ' + (editSelect.options.length - 1) + ' countries');
            } else {
                results.push('❌ Edit form dropdown not populated');
            }
            
            // Test 3: Data Structure
            if (countries.length > 0 && countries[0].countryName) {
                results.push('✅ Country data structure is correct (has countryName field)');
            } else if (countries.length > 0) {
                results.push('❌ Country data structure missing countryName field');
            }
            
            document.getElementById('testResults').innerHTML = 
                '<h5>Test Results:</h5><ul><li>' + results.join('</li><li>') + '</li></ul>';
        }

        function testAddForm() {
            const select = document.getElementById('addCountry');
            const selectedValue = select.value;
            alert('Add form test - Selected country: ' + (selectedValue || 'None selected'));
        }

        function testEditForm() {
            const select = document.getElementById('editCountry');
            const selectedValue = select.value;
            alert('Edit form test - Selected country: ' + (selectedValue || 'None selected'));
        }
    </script>
</body>
</html>
